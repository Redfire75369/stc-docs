<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Visitor generator for the rust language."><meta name="keywords" content="rust, rustlang, rust-lang, swc_visit"><title>swc_visit - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-1f7d512b176f0f72.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Bold-124a1ca42af929b6.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-b826345d929eb323.css" id="mainThemeStyle"><link rel="stylesheet" id="themeStyle" href="../static.files/light-87108236bf50c158.css"><link rel="stylesheet" disabled href="../static.files/dark-839c5fb8722cb456.css"><link rel="stylesheet" disabled href="../static.files/ayu-d48ac194417684c8.css"><script id="default-settings" ></script><script src="../static.files/storage-d43fa987303ecbbb.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-0dede64717b247ca.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-201a7e04dc4c6fce.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../swc_visit/index.html"><div class="logo-container"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></div></a><h2></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../swc_visit/index.html"><div class="logo-container"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></div></a><h2 class="location"><a href="#">Crate swc_visit</a></h2><div class="sidebar-elems"><ul class="block"><li class="version">Version 0.2.5</li><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#modules">Modules</a></li><li><a href="#macros">Macros</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-5ec35bf9ca753509.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn">Crate <a class="mod" href="#">swc_visit</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../src/swc_visit/lib.rs.html#1-189">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Visitor generator for the rust language.</p>
<p>There are three variants of visitor in swc. Those are <code>Fold</code>, <code>VisitMut</code>,
<code>Visit</code>.</p>
<h2 id="comparisons"><a href="#comparisons">Comparisons</a></h2><h3 id="fold-vs-visitmut"><a href="#fold-vs-visitmut"><code>Fold</code> vs <code>VisitMut</code></a></h3>
<p><code>Fold</code> and <code>VisitMut</code> do almost identical tasks, but <code>Fold</code> is easier to use
while being slower and weak to stack overflow for very deep asts. <code>Fold</code> is
fast enough for almost all cases so it would be better to start with <code>Fold</code>.</p>
<p>By very deep asts, I meant code like thousands of <code>a + a + a + a + ...</code>.</p>
<h2 id="fold"><a href="#fold"><code>Fold</code></a></h2>
<p><code>Fold</code> takes ownership of value, which means you have to return the new
value. Returning new value means returning ownership of the value. But you
don’t have to care about ownership or about managing memories while using
such visitors. <code>rustc</code> handles them automatically and all allocations will
be freed when it goes out of the scope.</p>
<p>You can invoke your <code>Fold</code> implementation like <code>node.fold_with(&amp;mut visitor)</code> where <code>visitor</code> is your visitor. Note that as it takes ownership
of value, you have to call <code>node.fold_children_with(self)</code> in e.g. <code>fn fold_module(&amp;mut self, m: Module) -&gt; Module</code> if you override the default
behavior. Also you have to store return value from <code>fold_children_with</code>,
like <code>let node = node.fold_children_with(self)</code>. Order of execution can be
controlled using this. If there is some logic that should be applied to the
parent first, you can call <code>fold_children_with</code> after such logic.</p>
<h2 id="visitmut"><a href="#visitmut"><code>VisitMut</code></a></h2>
<p><code>VisitMut</code> uses a mutable reference to AST nodes (e.g. <code>&amp;mut Expr</code>). You can
use <code>MapWithMut</code> from <code>swc_ecma_transforms_base</code> to get owned value from a
mutable reference.</p>
<p>You will typically use code like</p>

<div class="example-wrap ignore"><div class='tooltip'>ⓘ</div><pre class="rust rust-example-rendered"><code><span class="kw-2">*</span>e = return_value.take();</code></pre></div>
<p>where <code>e = &amp;mut Expr</code> and <code>return_value</code> is also <code>&amp;mut Expr</code>. <code>take()</code> is an
extension method defined on <code>MapWithMut</code>.  It’s almost identical to <code>Fold</code>,
so I’ll skip memory management.</p>
<p>You can invoke your <code>VisitMut</code> implementation like <code>node.visit_mut_with(&amp;mut visitor)</code> where <code>visitor</code> is your visitor. Again, you need to call
<code>node.visit_mut_children_with(self)</code> in visitor implementation if you want
to modify children nodes. You don’t need to store the return value in this
case.</p>
<h2 id="visit"><a href="#visit"><code>Visit</code></a></h2>
<p><code>Visit</code> uses non-mutable references to AST nodes. It can be used to see if
an AST node contains a specific node nested deeply in the AST. This is
useful for checking if AST node contains <code>this</code>. This is useful for lots of
cases - <code>this</code> in arrow expressions are special and we need to generate
different code if a <code>this</code> expression is used.</p>
<p>You can use your <code>Visit</code> implementation like  <code>node.visit_with(&amp;Invalid{ span: DUMY_SP, }, &amp;mut visitor</code>. I think API is misdesigned, but it works
and there are really lots of code using <code>Visit</code> already.</p>
</div></details><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="mod" href="util/index.html" title="swc_visit::util mod">util</a></div><div class="item-right docblock-short">Some utilities for generated visitors.</div></div></div><h2 id="macros" class="small-section-header"><a href="#macros">Macros</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="macro" href="macro.chain.html" title="swc_visit::chain macro">chain</a></div><div class="item-right docblock-short">Chains multiple visitor.</div></div><div class="item-row"><div class="item-left module-item"><a class="macro" href="macro.define.html" title="swc_visit::define macro">define</a></div><div class="item-right docblock-short">This creates <code>Visit</code>. This is extensible visitor generator, and it</div></div></div><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.All.html" title="swc_visit::All struct">All</a></div><div class="item-right docblock-short">Visit all children nodes. This converts <code>VisitAll</code> to <code>Visit</code>. The type
parameter <code>V</code> should implement <code>VisitAll</code> and <code>All&lt;V&gt;</code> implements <code>Visit</code>.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.AndThen.html" title="swc_visit::AndThen struct">AndThen</a></div><div class="item-right docblock-short">A visitor which applies <code>A</code> and then <code>B</code>.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Optional.html" title="swc_visit::Optional struct">Optional</a></div><div class="item-right docblock-short">A visitor which visits node only if <code>enabled</code> is true.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Repeat.html" title="swc_visit::Repeat struct">Repeat</a></div><div class="item-right docblock-short">A visitor which applies <code>V</code> again and again if <code>V</code> modifies the node.</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Either.html" title="swc_visit::Either enum">Either</a></div><div class="item-right docblock-short">The enum <code>Either</code> with variants <code>Left</code> and <code>Right</code> is a general purpose
sum type with two cases.</div></div></div><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.Repeated.html" title="swc_visit::Repeated trait">Repeated</a></div><div class="item-right docblock-short">Trait for a pass which is designed to invoked multiple time to same input.</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="swc_visit" data-themes="" data-resource-suffix="" data-rustdoc-version="1.67.0-nightly (7eef946fc 2022-11-06)" data-search-js="search-39ee4160c7dc16c9.js" data-settings-js="settings-3a0b9947ba1bd99a.js" data-settings-css="settings-a66f7524084a489a.css" ></div></body></html>